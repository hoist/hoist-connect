{"version":3,"sources":["connector.js"],"names":[],"mappings":"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","file":"connector.js","sourcesContent":["'use strict';\nimport errors from '@hoist/errors';\nimport Pipeline from '@hoist/connector-pipeline';\nimport BaseAPI from './base_api';\nimport {\n  filter, functions\n}\nfrom 'lodash';\nimport logger from '@hoist/logger';\nimport Bluebird from 'bluebird';\n/**\n * Hoists API wrapper around connectors\n */\nclass ConnectorAPI extends BaseAPI {\n  /**\n   * create a new connector API\n   * @param {string} key - the connector key\n   */\n  constructor(key) {\n    super();\n    this._logger = logger.child({\n      cls: this.constructor.name\n    });\n    if (!key) {\n      throw new errors.connector.request.InvalidError();\n    }\n    this._pipeline = new Pipeline();\n    this._key = key;\n    this._loadConnector();\n  }\n  _loadConnector() {\n    if (!this._connector) {\n      this._connector = this._pipeline.loadConnector(this._key).then((c) => {\n\n        let methods = filter(functions(c), (property) => {\n\n          if (property.startsWith('_') || property === 'receiveBounce' || this[property]) {\n            return false;\n          } else {\n            return true;\n          }\n        });\n        //we should always show the rest params but they might return an error\n        methods = methods.concat(['get', 'post', 'put', 'delete']);\n        methods.forEach((method) => {\n          /**\n           * also has all methods of underlying connector\n           */\n          let _this = this;\n          this[method] = function () {\n            _this._logger.info('proxying method ' + method);\n            if (typeof c[method] !== 'function') {\n              throw new errors.connector.request.UnsupportedError(method + ' method unsupported');\n            }\n            let callback;\n            let args = Array.prototype.slice.call(arguments);\n            if (typeof (args[args.length - 1]) === 'function') {\n              callback = args.pop();\n            }\n            return Bluebird.resolve(c[method].apply(c, args))\n              .nodeify(callback);\n          };\n        });\n      });\n\n    }\n    return this._connector;\n  }\n  init() {\n    return this._loadConnector();\n  }\n  get(...params) {\n    return this.loadConnector()\n      .then(() => {\n        return this.get.apply(this, params);\n      });\n  }\n  put(...params) {\n    return this.loadConnector()\n      .then(() => {\n        return this.put.apply(this, params);\n      });\n\n  }\n  post(...params) {\n    return this.loadConnector()\n      .then(() => {\n        return this.post.apply(this, params);\n      });\n  }\n  delete(...params) {\n    return this.loadConnector()\n      .then(() => {\n        return this.delete.apply(this, params);\n      });\n  }\n}\n\nexport default ConnectorAPI;\n"],"sourceRoot":"/source/"}